---
import { getPageContent } from '~/lib/sanity';
import Layout from '~/layouts/PageLayout.astro';

import BigNote from '~/components/widgets/BigNote.astro';
import CallToAction from '~/components/widgets/CallToAction.astro';
import Content from '~/components/widgets/Content.astro';
import FAQs from '~/components/widgets/FAQs.astro';
import Features from '~/components/widgets/Features.astro';
import Hero2 from '~/components/widgets/Hero2.astro';
import Stats from '~/components/widgets/Stats.astro';
import Steps from '~/components/widgets/Steps.astro';
import Testimonials from '~/components/widgets/Testimonials.astro';

// Get content from Sanity
const pageData = await getPageContent('homepage', 'de');
const { metadata, hero, note, features, content, steps, faqs, stats, testimonials, cta } = pageData || {};
---

<Layout metadata={metadata}>
  {hero && (
    <Hero2
      title={hero.title}
      tagline={hero.tagline}
      image={hero.image}
      actions={hero.actions}
    />
  )}

  <!-- Note Widget ******************* -->

  {note && (
    <BigNote
      title={`<span class='text-white text-7xl'>${note.title}</span>`}
      subtitle={`<br/><a href='#features' class='text-white'><u>${note.subtitle}</u></a>`}
    >
      <Fragment slot="bg">
        <div class="absolute inset-0 bg-primary dark:bg-transparent"></div>
      </Fragment>
    </BigNote>
  )}

  <!-- Note Widget ******************* -->
  <!-- Features Widget *************** -->

  {features && (
    <Features
      id="features"
      title={features.title}
      subtitle={features.subtitle}
      items={features.items}
    />
  )}

  <!-- Content Widget **************** -->

  {content && content.map((section) => (
    <Content
      isReversed={section.isReversed}
      items={section.items}
      image={section.image}
    >
      <Fragment slot="content">
        <h3 class="text-2xl font-bold tracking-tight dark:text-white sm:text-3xl mb-2">{section.title}</h3>
        {section.subtitle && <p class="text-muted dark:text-gray-400">{section.subtitle}</p>}
        {section.description && <p class="mt-3">{section.description}</p>}
      </Fragment>

      <Fragment slot="bg">
        <div class="absolute inset-0 bg-blue-50 dark:bg-transparent"></div>
      </Fragment>
    </Content>
  ))}

  <!-- Steps Widget ****************** -->

  {steps && (
    <Steps
      title={steps.title}
      subtitle={steps.subtitle}
      items={steps.items}
    />
  )}

  <!-- FAQs Widget ******************* -->
  
  {faqs && (
    <FAQs
      title={faqs.title}
      subtitle={faqs.subtitle}
      items={faqs.items}
    />
  )}

  <!-- Stats Widget ****************** -->
  
  {stats && (
    <Stats
      title={stats.title}
      stats={stats.items}
    />
  )}

  <!-- Testimonials Widget *********** -->
  
  {testimonials && (
    <Testimonials
      title={testimonials.title}
      subtitle={testimonials.subtitle}
      testimonials={testimonials.items}
    />
  )}

  <!-- CallToAction Widget *********** -->

  {cta && (
    <CallToAction
      actions={cta.actions}
    >
      <Fragment slot="title">{cta.title}</Fragment>
      <Fragment slot="subtitle">{cta.subtitle}</Fragment>
    </CallToAction>
  )}
</Layout>